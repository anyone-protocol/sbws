<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1171px" preserveAspectRatio="none" style="width:483px;height:1171px;" version="1.1" viewBox="0 0 483 1171" width="483px" zoomAndPan="magnify"><defs><filter height="300%" id="fufbnejl6losm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="352" x="64.75" y="26.708">Activity diagram sbws bw_torflow_scale</text><ellipse cx="244.5" cy="40.9531" fill="#000000" filter="url(#fufbnejl6losm)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="276" x="106.5" y="70.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="256" x="116.5" y="92.0918">mu = mean([l.bw_mean for l in bw_lines])</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="260" x="114.5" y="124.9219"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="240" x="124.5" y="146.0605">muf = mean([l.bw_filt for l in bw_lines])</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="197" y="178.8906"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="75" x="207" y="200.0293">sum_bw = 0</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="66" x="211.5" y="276.8594"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="46" x="221.5" y="297.998">bw_obs</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="396" x="46.5" y="330.8281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="376" x="56.5" y="351.9668">desc_bw = min(desc_bw_obs, l.desc_bw_bur, l.desc_bw_avg)</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="213" x="138" y="384.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="193" x="148" y="405.9355">ratio_stream = l.bw_mean / mu</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="247" x="121" y="438.7656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="227" x="131" y="459.9043">ratio_stream_filtered = l.bw_filt / muf</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="318" x="85.5" y="492.7344"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="298" x="95.5" y="513.873">ratio = max(ratio_stream, ratio_stream_filtered)</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="158" x="165.5" y="546.7031"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="138" x="175.5" y="567.8418">l.bw = ratio * desc_bw</text><polygon fill="#FEFECE" filter="url(#fufbnejl6losm)" points="189.5,600.6719,299.5,600.6719,311.5,612.6719,299.5,624.6719,189.5,624.6719,177.5,612.6719,189.5,600.6719" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="110" x="189.5" y="616.48">router_statuses_d?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="157.5" y="610.0776">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="311.5" y="610.0776">no</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="87" y="683.0742"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="101" x="97" y="704.2129">sum_bw += l.bw</text><polygon fill="#FEFECE" filter="url(#fufbnejl6losm)" points="58,634.6719,237,634.6719,249,646.6719,237,658.6719,58,658.6719,46,646.6719,58,634.6719" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="151.5" y="668.8823">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="179" x="58" y="650.48">l.node_id in router_statuses_d?</text><polygon fill="#FEFECE" filter="url(#fufbnejl6losm)" points="147.5,737.043,159.5,749.043,147.5,761.043,135.5,749.043,147.5,737.043" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="281" y="634.6719"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="101" x="291" y="655.8105">sum_bw += l.bw</text><polygon fill="#FEFECE" filter="url(#fufbnejl6losm)" points="244.5,767.043,256.5,779.043,244.5,791.043,232.5,779.043,244.5,767.043" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#fufbnejl6losm)" points="196.5,232.8594,292.5,232.8594,304.5,244.8594,292.5,256.8594,196.5,256.8594,184.5,244.8594,196.5,232.8594" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="96" x="196.5" y="248.6675">for l in bw_lines?</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="166" y="833.043"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="137" x="176" y="854.1816">hlimit = sum_bw * cap</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="199" x="145" y="931.0117"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="179" x="155" y="952.1504">bw_scaled = min(hlimit, l.bw)</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="402" x="43.5" y="999.9805"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="382" x="53.5" y="1021.1191">l.bw = kb_round_x_sig_dig(bw_scaled, digits=num_round_dig)</text><polygon fill="#FEFECE" filter="url(#fufbnejl6losm)" points="196.5,887.0117,292.5,887.0117,304.5,899.0117,292.5,911.0117,196.5,911.0117,184.5,899.0117,196.5,887.0117" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="96" x="196.5" y="902.8198">for l in bw_lines?</text><rect fill="#FEFECE" filter="url(#fufbnejl6losm)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="423" x="33" y="1075.9492"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="403" x="43" y="1097.0879">return sorted(bw_lines_tf, key=lambda x: x.bw, reverse=reverse)</text><ellipse cx="244.5" cy="1139.918" fill="none" filter="url(#fufbnejl6losm)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="245" cy="1140.418" fill="#000000" filter="url(#fufbnejl6losm)" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="50.9531" y2="70.9531"/><polygon fill="#A80036" points="240.5,60.9531,244.5,70.9531,248.5,60.9531,244.5,64.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="104.9219" y2="124.9219"/><polygon fill="#A80036" points="240.5,114.9219,244.5,124.9219,248.5,114.9219,244.5,118.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="158.8906" y2="178.8906"/><polygon fill="#A80036" points="240.5,168.8906,244.5,178.8906,248.5,168.8906,244.5,172.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="310.8281" y2="330.8281"/><polygon fill="#A80036" points="240.5,320.8281,244.5,330.8281,248.5,320.8281,244.5,324.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="364.7969" y2="384.7969"/><polygon fill="#A80036" points="240.5,374.7969,244.5,384.7969,248.5,374.7969,244.5,378.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="418.7656" y2="438.7656"/><polygon fill="#A80036" points="240.5,428.7656,244.5,438.7656,248.5,428.7656,244.5,432.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="472.7344" y2="492.7344"/><polygon fill="#A80036" points="240.5,482.7344,244.5,492.7344,248.5,482.7344,244.5,486.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="526.7031" y2="546.7031"/><polygon fill="#A80036" points="240.5,536.7031,244.5,546.7031,248.5,536.7031,244.5,540.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="147.5" x2="147.5" y1="658.6719" y2="683.0742"/><polygon fill="#A80036" points="143.5,673.0742,147.5,683.0742,151.5,673.0742,147.5,677.0742" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="249" x2="261" y1="646.6719" y2="646.6719"/><polygon fill="#A80036" points="257,690.0586,261,700.0586,265,690.0586,261,694.0586" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="261" x2="261" y1="646.6719" y2="749.043"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="261" x2="159.5" y1="749.043" y2="749.043"/><polygon fill="#A80036" points="169.5,745.043,159.5,749.043,169.5,753.043,165.5,749.043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="147.5" x2="147.5" y1="717.043" y2="737.043"/><polygon fill="#A80036" points="143.5,727.043,147.5,737.043,151.5,727.043,147.5,731.043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="177.5" x2="147.5" y1="612.6719" y2="612.6719"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="147.5" x2="147.5" y1="612.6719" y2="634.6719"/><polygon fill="#A80036" points="143.5,624.6719,147.5,634.6719,151.5,624.6719,147.5,628.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="311.5" x2="341.5" y1="612.6719" y2="612.6719"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="341.5" x2="341.5" y1="612.6719" y2="634.6719"/><polygon fill="#A80036" points="337.5,624.6719,341.5,634.6719,345.5,624.6719,341.5,628.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="147.5" x2="147.5" y1="761.043" y2="779.043"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="147.5" x2="232.5" y1="779.043" y2="779.043"/><polygon fill="#A80036" points="222.5,775.043,232.5,779.043,222.5,783.043,226.5,779.043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="341.5" x2="341.5" y1="668.6406" y2="779.043"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="341.5" x2="256.5" y1="779.043" y2="779.043"/><polygon fill="#A80036" points="266.5,775.043,256.5,779.043,266.5,783.043,262.5,779.043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="580.6719" y2="600.6719"/><polygon fill="#A80036" points="240.5,590.6719,244.5,600.6719,248.5,590.6719,244.5,594.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="256.8594" y2="276.8594"/><polygon fill="#A80036" points="240.5,266.8594,244.5,276.8594,248.5,266.8594,244.5,270.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="791.043" y2="801.043"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="454.5" y1="801.043" y2="801.043"/><polygon fill="#A80036" points="450.5,519.1523,454.5,509.1523,458.5,519.1523,454.5,515.1523" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="454.5" x2="454.5" y1="244.8594" y2="801.043"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="454.5" x2="304.5" y1="244.8594" y2="244.8594"/><polygon fill="#A80036" points="314.5,240.8594,304.5,244.8594,314.5,248.8594,310.5,244.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="184.5" x2="24" y1="244.8594" y2="244.8594"/><polygon fill="#A80036" points="20,505.1523,24,515.1523,28,505.1523,24,509.1523" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="24" x2="24" y1="244.8594" y2="813.043"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="24" x2="244.5" y1="813.043" y2="813.043"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="813.043" y2="833.043"/><polygon fill="#A80036" points="240.5,823.043,244.5,833.043,248.5,823.043,244.5,827.043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="212.8594" y2="232.8594"/><polygon fill="#A80036" points="240.5,222.8594,244.5,232.8594,248.5,222.8594,244.5,226.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="964.9805" y2="999.9805"/><polygon fill="#A80036" points="240.5,989.9805,244.5,999.9805,248.5,989.9805,244.5,993.9805" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="911.0117" y2="931.0117"/><polygon fill="#A80036" points="240.5,921.0117,244.5,931.0117,248.5,921.0117,244.5,925.0117" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="1033.9492" y2="1043.9492"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="457.5" y1="1043.9492" y2="1043.9492"/><polygon fill="#A80036" points="453.5,980.4805,457.5,970.4805,461.5,980.4805,457.5,976.4805" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="457.5" x2="457.5" y1="899.0117" y2="1043.9492"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="457.5" x2="304.5" y1="899.0117" y2="899.0117"/><polygon fill="#A80036" points="314.5,895.0117,304.5,899.0117,314.5,903.0117,310.5,899.0117" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="184.5" x2="31.5" y1="899.0117" y2="899.0117"/><polygon fill="#A80036" points="27.5,966.4805,31.5,976.4805,35.5,966.4805,31.5,970.4805" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="31.5" x2="31.5" y1="899.0117" y2="1055.9492"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="31.5" x2="244.5" y1="1055.9492" y2="1055.9492"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="1055.9492" y2="1075.9492"/><polygon fill="#A80036" points="240.5,1065.9492,244.5,1075.9492,248.5,1065.9492,244.5,1069.9492" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="867.0117" y2="887.0117"/><polygon fill="#A80036" points="240.5,877.0117,244.5,887.0117,248.5,877.0117,244.5,881.0117" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="244.5" x2="244.5" y1="1109.918" y2="1129.918"/><polygon fill="#A80036" points="240.5,1119.918,244.5,1129.918,248.5,1119.918,244.5,1123.918" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="119" x="181.25" y="1158.2002">last updated 2021-01-08</text><!--
@startuml

title Activity diagram sbws bw_torflow_scale

start
:mu = mean([l.bw_mean for l in bw_lines]);
:muf = mean([l.bw_filt for l in bw_lines]);
:sum_bw = 0;
while (for l in bw_lines?)
    :bw_obs;
    :desc_bw = min(desc_bw_obs, l.desc_bw_bur, l.desc_bw_avg);
    :ratio_stream = l.bw_mean / mu;
    :ratio_stream_filtered = l.bw_filt / muf;
    :ratio = max(ratio_stream, ratio_stream_filtered);
    :l.bw = ratio * desc_bw;
    if (router_statuses_d?) then (yes)
        if (l.node_id in router_statuses_d?) then (yes)
            :sum_bw += l.bw;
        endif
    else (no)
        :sum_bw += l.bw;
    endif
endwhile
:hlimit = sum_bw * cap;
while (for l in bw_lines?)
    :bw_scaled = min(hlimit, l.bw);
    :l.bw = kb_round_x_sig_dig(bw_scaled, digits=num_round_dig);
endwhile
:return sorted(bw_lines_tf, key=lambda x: x.bw, reverse=reverse);
stop

footer last updated 2021-01-08
@enduml

PlantUML version 1.2018.13(Mon Nov 26 17:11:51 UTC 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.11+9-post-Debian-1deb10u1
Operating System: Linux
OS Version: 4.19.0-16-amd64
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>